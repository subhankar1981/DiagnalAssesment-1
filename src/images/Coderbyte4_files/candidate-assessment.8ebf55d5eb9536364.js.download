$(document).ready(function(){var app=new Vue({el:'#container',data:{'icons':{'saved_answers':'https://coderbytestaticimages.s3.amazonaws.com/dashboard/done-1.png','record_video_blue':'https://coderbytestaticimages.s3.amazonaws.com/dashboard/record_video_blue.png','green_checkmark':'https://coderbytestaticimages.s3.amazonaws.com/orgs-v4/2021/checkmark.png',},'svgIcons':{'videoResponseUpload':`
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M6.7491 2.56069L7.46873 3.28033L8.5294 2.21967L6.52941 0.219685C6.23652 -0.0732079 5.76164 -0.0732079 5.46875 0.219685L3.46875 2.21969L4.52941 3.28035L5.2491 2.56066V7H6.7491V2.56069Z" fill="white"/>
          <path d="M11 6V10C11 10.5523 10.5523 11 10 11H2C1.44772 11 1 10.5523 1 10V6" stroke="white" stroke-width="1.5"/>
          </svg>`,'stopRecording':`
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="6" height="6" fill="white"/>
          </svg>`,'startRecording':`
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.11116 7.66293C6.78226 7.8827 6.39557 8 6 8C5.46979 7.99938 4.96147 7.78849 4.58653 7.41358C4.2116 7.03868 4.00067 6.53038 4 6.00017C3.99997 5.6046 4.11724 5.2179 4.33698 4.88898C4.55672 4.56006 4.86907 4.30369 5.23452 4.15229C5.59997 4.00089 6.0021 3.96126 6.39008 4.03841C6.77805 4.11556 7.13443 4.30603 7.41415 4.58573C7.69387 4.86543 7.88437 5.22179 7.96156 5.60976C8.03874 5.99772 7.99914 6.39987 7.84777 6.76533C7.6964 7.13079 7.44006 7.44316 7.11116 7.66293Z" fill="white"/>
          <path opacity="0.1" d="M8.77789 10.1573C7.95564 10.7067 6.98892 11 6 11C4.67447 10.9984 3.40367 10.4712 2.46634 9.53396C1.529 8.59671 1.00167 7.32595 1 6.00042C0.999917 5.0115 1.29309 4.04476 1.84245 3.22246C2.3918 2.40016 3.17267 1.75923 4.08629 1.38073C4.99991 1.00222 6.00526 0.903146 6.97519 1.09602C7.94512 1.2889 8.83608 1.76507 9.53538 2.46432C10.2347 3.16357 10.7109 4.05448 10.9039 5.0244C11.0969 5.99431 10.9979 6.99967 10.6194 7.91332C10.241 8.82698 9.60015 9.60789 8.77789 10.1573Z" fill="white"/>
          </svg>`,'camera':`
          <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clip-path="url(#clip0_2385_60322)">
          <path d="M15.3346 5.16797L10.668 8.5013L15.3346 11.8346V5.16797Z" stroke="#368BEF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M9.33464 3.83203H2.0013C1.26492 3.83203 0.667969 4.42898 0.667969 5.16536V11.832C0.667969 12.5684 1.26492 13.1654 2.0013 13.1654H9.33464C10.071 13.1654 10.668 12.5684 10.668 11.832V5.16536C10.668 4.42898 10.071 3.83203 9.33464 3.83203Z" stroke="#368BEF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </g>
          <defs>
          <clipPath id="clip0_2385_60322">
          <rect width="16" height="16" fill="white" transform="translate(0 0.5)"/>
          </clipPath>
          </defs>
          </svg>`,'importIcon':`
          <svg width="12" height="13" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_1433_20003)">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M6.7491 3.06069L7.46873 3.78033L8.5294 2.71967L6.52941 0.719685C6.23652 0.426792 5.76164 0.426792 5.46875 0.719685L3.46875 2.71969L4.52941 3.78035L5.2491 3.06066V7.5H6.7491V3.06069Z" fill="#368BEF"/>
            <path d="M11 6.5V10.5C11 11.0523 10.5523 11.5 10 11.5H2C1.44772 11.5 1 11.0523 1 10.5V6.5" stroke="#368BEF" stroke-width="1.5"/>
            </g>
            <defs>
            <clipPath id="clip0_1433_20003">
            <rect width="12" height="12" fill="white" transform="translate(0 0.5)"/>
            </clipPath>
            </defs>
          </svg>`,},'showing':{'firstTime':!0,'mainAssessment':!1,'modalDone':!1,'modalCodeSubmit':!1,'modalBeginVideoResponse':!1,},'authObject':window.__authObject,'beginAssessmentText':'Begin Assessment','submittedTestAlready':window.__assessment_assessmentViewObject.data.already_submitted,'storageKey':'startedTest-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyAnswersMC':'savedAnswersMC-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyAnswersOE':'savedAnswersOE-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyProgressiveLoadingIndex':'savedProgressiveIndex-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyAnswersVideoResponses':'savedAnswersVideoResponses-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyAnswersWebcamResponses':'savedAnswersWebcamResponses-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyRandomizeMCQSubset':'savedRandomMCQSubset-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyRandomizeOESubset':'savedRandomOESubset-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyRandomizeChalSubset':'savedRandomChalSubset-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyScrollPosition':'savedLastScrollPosition-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'storageKeyPersonalityTest':'ptTest-'+window.__assessment_testIdMock+'-'+window.__authObject.username,'testId':window.__assessment_testId,'assessmentObject':window.__assessment_assessmentViewObject,'replaceChallengeTitlesWithMask':!1,'MCQuestionsSubset':!1,'OEQuestionsSubset':!1,'MCAnswers':{},'OEAnswers':{},'personalityTestTypes':window.__org_shared.personalityTestTypes,'showingPersonalitySection':!1,'completedPersonalityTest':!1,'progressiveLoadingIndex':{'Multiple choice':0,'Open-ended':0,},'solvedChallenges':0,'timerCountdown':window.__assessment_timerCountdown,'timerArea':'__insert_time_left','showTimerGraph':!0,'submittingAnswers':!1,'submittingAssessment':!1,'saveButtonText':'Save Answers','startingChallengeButton':!1,'defaultLanguage':'JavaScript','uploadingFile':!1,'timeZone':undefined,'recordedBlobs':[],'videoStream':!1,'mediaRecorder':!1,'videoSteamForWhatOE':!1,'twilioRoom':!1,'videoResponsesSubmitted':{},'webcamVerificationSubmitted':{},'timerSeconds':window.__assessment_assessmentViewObject.data.org_id==='coderbytesandbox'?15:120,'timerInternal':null,},created:function(){if(this.assessmentObject.data.org_id==='rightbalance-k55eh'){this.timerSeconds=1200}
var that=this;this.timeZone=getTimeZone();this.checkHash();var tempMC=localStorage.getItem(that.storageKeyAnswersMC);var tempOE=localStorage.getItem(that.storageKeyAnswersOE);var tempVR=localStorage.getItem(that.storageKeyAnswersVideoResponses);var tempWV=localStorage.getItem(that.storageKeyAnswersWebcamResponses);if(tempMC&&Object.keys(tempMC).length>0){this.assessmentObject.data.multiple_choice_answers=JSON.parse(tempMC)}
if(tempOE&&Object.keys(tempOE).length>0){this.assessmentObject.data.open_ended_answers=JSON.parse(tempOE)}
if(tempVR&&Object.keys(tempVR).length>0){this.videoResponsesSubmitted=JSON.parse(tempVR)}
if(tempWV&&Object.keys(tempWV).length>0){this.webcamVerificationSubmitted=JSON.parse(tempWV)}
if(this.assessmentObject.data.progressive_loading){var tempProgIndex=localStorage.getItem(that.storageKeyProgressiveLoadingIndex);if(tempProgIndex){this.progressiveLoadingIndex=JSON.parse(tempProgIndex)}}
if(this.assessmentObject.data.personality_test){var finished=localStorage.getItem(that.storageKeyPersonalityTest);if(finished){this.completedPersonalityTest=!0}}
if(this.assessmentObject.data.multiple_choice_questions){for(var i=0;i<this.assessmentObject.data.multiple_choice_questions.length;i++){var quesID=this.assessmentObject.data.multiple_choice_questions[i][0];var quesObject=this.assessmentObject.data.multiple_choice_questions[i][1];var answerExists=this.assessmentObject.data.multiple_choice_answers[quesID];if(answerExists){this.saveMCAnswer(quesID,answerExists)}
this.assessmentObject.data.multiple_choice_questions[i][1].answers=shuffleArray(quesObject.answers)}
if(this.assessmentObject.data.randomize_mcq){this.randomizeQuestionsBeforeDisplaying('multiple_choice_questions',this.storageKeyRandomizeMCQSubset,this.assessmentObject.data.multiple_choice_questions,this.assessmentObject.data.randomize_mcq,)}
if(this.assessmentObject.data.randomize_oe){this.randomizeQuestionsBeforeDisplaying('open_ended_questions',this.storageKeyRandomizeOESubset,this.assessmentObject.data.open_ended_questions,this.assessmentObject.data.randomize_oe,)}
if(this.assessmentObject.data.randomize_challenges){this.randomizeQuestionsBeforeDisplaying('challenges',this.storageKeyRandomizeChalSubset,this.assessmentObject.data.challenges,this.assessmentObject.data.randomize_challenges,)}}
if(this.assessmentObject.data.open_ended_questions){for(var i=0;i<this.assessmentObject.data.open_ended_questions.length;i++){var quesID=this.assessmentObject.data.open_ended_questions[i][0];var answerExists=this.assessmentObject.data.open_ended_answers[quesID];if(answerExists){this.saveOEAnswer(quesID,answerExists)}}}
setTimeout(function(){highlightCodeSnippetsOnPage(['.open_ended_ques h3','.each_mc .mc_option','.outerWelcomeWrapperText'])},0);this.getSolvedChallenges();if(window.localStorage){var defaultLanguage=window.localStorage.getItem('default-language');if(defaultLanguage&&window.__MAIN_LANGUAGE_LIST[defaultLanguage]){this.defaultLanguage=defaultLanguage}}},mounted:function(){var that=this;if(!this.assessmentObject.data.previewing_test&&!this.assessmentObject.data.over_time_limit){var startedTest=localStorage.getItem(that.storageKey);if(startedTest&&startedTest=='true'){this.showActualTest()}}
if(!this.assessmentObject.error_message&&!this.assessmentObject.data.previewing_test){if(this.authObject.isAdmin){__showTimerMessage('(viewing as admin)',that.timerArea)}else{__beginTimer(that.timerCountdown,that.timerArea)}}
if(!this.assessmentObject.data.previewing_test){if(this.submittedTestAlready){console.log('assessment already submitted');$('.submit_final_assessment').attr('disabled','disabled');$('.submit_final_assessment').css({'opacity':'0.4'});$('.submit_final_assessment').html('Already Submitted')}}
if(!this.assessmentObject.error_message&&!this.assessmentObject.data.previewing_test&&!this.authObject.isAdmin&&!this.submittedTestAlready){$.post('/backend/requests/organizations/candidate_timer.php',{user:that.authObject.username,testId:that.testId,action:'start',csrf_token:that.authObject.csrfToken?that.authObject.csrfToken:null,},function(data){if(data){console.log('success: timer auto started')}else{alert('Error starting test. Please contact support@coderbyte.com')}})}
window.onbeforeunload=function(e){localStorage.setItem(that.storageKeyScrollPosition,$('#programming_chals_area').scrollTop())}},computed:{computed_checkSolvedAllOE:function(){var videosUploaded=Object.keys(this.videoResponsesSubmitted).length;var oeNotAnswered=Object.values(this.OEAnswers).filter(el=>el===-1).length;if((oeNotAnswered-videosUploaded)>0)return!1;return(Object.keys(this.OEAnswers).length+Object.keys(this.videoResponsesSubmitted).length)>=this.assessmentObject.data.open_ended_questions.length},computed_checkSolvedAllMC:function(){if(Object.values(this.MCAnswers).indexOf(-1)!==-1)return!1;return Object.keys(this.MCAnswers).length===this.assessmentObject.data.multiple_choice_questions.length},computed_checkSolvedAllChallenges:function(){if(this.assessmentObject.data.webcam_verification){var totalRequired=Object.values(this.assessmentObject.data.webcam_verification).filter(el=>el===!0).length
var videosUploaded=Object.keys(this.webcamVerificationSubmitted).length;return(this.solvedChallenges===this.assessmentObject.data.challenges.length)&&(totalRequired===videosUploaded)}else{return this.solvedChallenges===this.assessmentObject.data.challenges.length}},computed_checkSolvedCompletedProjects:function(){return this.assessmentObject.data.project_submission_count>=this.assessmentObject.data.projects.length},computed_checkSolvedPersonality:function(){return this.completedPersonalityTest},},methods:{checkHash:function(){var that=this;if(window.location.hash!==''){var hashString=window.location.hash.replace('#','');if(hashString==='saved_answers'||hashString==='submitted_assessment'){that.$set(that.showing,'modalDone',!0);setTimeout(function(){that.$set(that.showing,'modalDone',!1);window.location.hash=''},2500)}
if(hashString==='submitted_code_solution'){that.$set(that.showing,'modalCodeSubmit',!0);setTimeout(function(){that.$set(that.showing,'modalCodeSubmit',!1);window.location.hash=''},2500)}}},randomizeQuestionsBeforeDisplaying:function(questionKey,localStorageKey,questionList,randomizeValue){var tempRandomMCQSubset=localStorage.getItem(localStorageKey);var thisCandidateQuestionIDs=[];if(!tempRandomMCQSubset){var tempShuffledArray=shuffleArray(questionList);tempShuffledArray=tempShuffledArray.slice(0,randomizeValue);if(questionKey==='challenges'){thisCandidateQuestionIDs=tempShuffledArray.map((el)=>{return el.title})}else{thisCandidateQuestionIDs=tempShuffledArray.map((el)=>{return el[0]})}
localStorage.setItem(localStorageKey,JSON.stringify(thisCandidateQuestionIDs))}else{thisCandidateQuestionIDs=JSON.parse(tempRandomMCQSubset)}
var _tempQuestionList=[];for(var i=0;i<questionList.length;i++){if(questionKey==='challenges'){if(thisCandidateQuestionIDs.indexOf(questionList[i].title)!==-1){_tempQuestionList.push(questionList[i])}}else{if(thisCandidateQuestionIDs.indexOf(questionList[i][0])!==-1){_tempQuestionList.push(questionList[i])}}}
console.log('showing subset of questions',questionKey,thisCandidateQuestionIDs);this.$set(this.assessmentObject.data,questionKey,_tempQuestionList);if(questionKey==='multiple_choice_questions'){this.MCQuestionsSubset=thisCandidateQuestionIDs}
if(questionKey==='open_ended_questions'){this.OEQuestionsSubset=thisCandidateQuestionIDs}},beginAssessment:function(){var that=this;if(this.assessmentObject.data.previewing_test||this.authObject.isAdmin){localStorage.setItem(that.storageKey,'true');this.showActualTest();__showTimerMessage('(viewing as admin)',that.timerArea);return}
this.beginAssessmentText='Loading...';var username=this.authObject.username||'';$.post('/backend/requests/organizations/candidate_timer.php',{user:username,testId:that.testId,action:'reset',noLog:'true',csrf_token:that.authObject.csrfToken?that.authObject.csrfToken:null,},function(data){if(data){var data=JSON.parse(data);console.log('=== TIMER ===',data);if(data.status==='success'&&data.timer){__beginTimer(data.timer,that.timerArea)}
localStorage.setItem(that.storageKey,'true');that.showActualTest()}else{alert('Error starting test. Please contact support@coderbyte.com')}})},showActualTest:function(){var that=this;this.$set(this.showing,'firstTime',!1);this.$set(this.showing,'mainAssessment',!0);setTimeout(function(){var body=document.body;var html=document.documentElement;var _height=Math.min(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);$('#programming_chals_area').css({'height':(_height-70)+'px'});$('#programming_chals_area .leftSide aside.welcomeText').css({'max-height':(_height-450)+'px'})},50);setTimeout(function(){that.__watchForFileInputChanges()},0);if(this.assessmentObject.data.section_ordering){setTimeout(function(){that.reorderSections()},50)}
setTimeout(function(){var scrollToLastPosition=localStorage.getItem(that.storageKeyScrollPosition);$('#programming_chals_area').animate({scrollTop:parseInt(scrollToLastPosition)})},250);setTimeout(function(){setupQuillsForQuestions()},50);setInterval(function(){that.saveAnswers('mc',!0);that.saveAnswers('oe',!0)},30000);if(this.assessmentObject.data&&this.assessmentObject.data.open_ended_questions){if(this.assessmentObject.data.open_ended_questions.length>0||this.assessmentObject.data.multiple_choice_questions.length>0){this.watchForTabLeaving()}
if(this.assessmentObject.data.open_ended_questions.length>0){this.watchForCopying()}}},watchForTabLeaving:function(){var that=this;window.onblur=function(){window.__timeBeforeLeavingPage=new Date()};window.onfocus=function(){if(window.__timeBeforeLeavingPage&&!that.assessmentObject.data.previewing_test){var timeDiff=(new Date()-window.__timeBeforeLeavingPage)/1000;if(timeDiff<2)return;var params={challenge:'__none__',testId:that.testId,duration:parseInt(timeDiff),};$.post('/backend/requests/editor/candidate_leaving_tab.php',params,function(data){console.log('tl saved',timeDiff)})}}},watchForCopying:function(){var that=this;if(this.assessmentObject.data.org_id==='superannotateaiinc-9twfm'){$('body').css({'-webkit-touch-callout':'none','-webkit-user-select':'none','-khtml-user-select':'none','-moz-user-select':'none','-ms-user-select':'none','user-select':'none',});$('body').bind('copy paste',function(e){e.preventDefault();return!1});return}
document.addEventListener('copy',function(e){});document.addEventListener('paste',function(e){var clipboardData=e.clipboardData||window.clipboardData;if(!clipboardData)return;var pastedData=clipboardData.getData('Text');if(isValidUrl(pastedData))return;console.log('pasted OE');$.post('/backend/requests/editor/candidate_copying.php',{challenge:'__none__',testId:that.testId,content:pastedData,},function(data){console.log('saved',data)})})},submitAndNext:function(key){var prevValue=this.progressiveLoadingIndex[key];this.$set(this.progressiveLoadingIndex,key,prevValue+1);var cachedProgObject=JSON.stringify(this.progressiveLoadingIndex);localStorage.setItem(this.storageKeyProgressiveLoadingIndex,cachedProgObject);if(key==='Open-ended'){setTimeout(function(){setupQuillsForQuestions()},50)}},saveAnswers:function(type,afterSubmittingAssessment){var that=this;var answerObject={};if(!afterSubmittingAssessment&&(this.submittingAnswers||this.submittedTestAlready))return;if(type==='mc'){if(Object.keys(this.MCAnswers).length===0)return;answerObject=JSON.stringify(this.MCAnswers)}
if(type==='oe'){if(Object.keys(this.OEAnswers).length===0)return;answerObject=JSON.stringify(this.OEAnswers)}
this.submittingAnswers=!0;this.saveButtonText='Saving...';$.post('/backend/requests/organizations/candidate_save_answers.php',{testId:that.testId,type:type,answerObject:answerObject,username:that.authObject.username},function(data){var data=JSON.parse(data);if(data&&data.status==='success'){console.log('answers saved',data);that.submittingAnswers=!1;that.saveButtonText='Save Answers';if(!afterSubmittingAssessment){window.location.hash='saved_answers';that.checkHash()}}})},saveTempAnswersInLocalStorage:debounce(function(){var that=this;var mc=JSON.stringify(that.MCAnswers);var oe=JSON.stringify(that.OEAnswers);localStorage.setItem(that.storageKeyAnswersMC,mc);localStorage.setItem(that.storageKeyAnswersOE,oe);console.log('saved answers in localStorage')},500),saveMCAnswer:function(questionID,answerID,userAction=!1){this.$set(this.MCAnswers,questionID,answerID);if(this.MCQuestionsSubset){for(var i=0;i<this.MCQuestionsSubset.length;i++){var quesId=this.MCQuestionsSubset[i];if(!this.MCAnswers[quesId]){this.$set(this.MCAnswers,quesId,-1)}}}
if(userAction){this.saveTempAnswersInLocalStorage()}},saveOEAnswer:function(questionID,answer){this.$set(this.OEAnswers,questionID,answer);if(this.OEQuestionsSubset){for(var i=0;i<this.OEQuestionsSubset.length;i++){var quesId=this.OEQuestionsSubset[i];if(!this.OEAnswers[quesId]){this.$set(this.OEAnswers,quesId,-1)}}}},editingOEAnswer:function(questionID,elementID){var answer=$(elementID).find('.ql-editor').html();this.saveOEAnswer(questionID,answer);this.saveTempAnswersInLocalStorage()},submitAssessment:function(){var that=this;var username=this.authObject.username||'';if(this.submittingAssessment)return;var confirmMsg='Once you submit you will not be able to modify your answers or solutions. Are you sure you want submit?';var didNotComplete=!this.computed_checkSolvedAllMC||!this.computed_checkSolvedAllChallenges||!this.computed_checkSolvedAllOE||!this.computed_checkSolvedCompletedProjects;if(didNotComplete){confirmMsg='You have not completed this assessment, are you sure you want to submit?'}
var r=confirm(confirmMsg);if(r===!0){var didNotComplete=!this.computed_checkSolvedAllMC||!this.computed_checkSolvedAllChallenges||!this.computed_checkSolvedAllOE||!this.computed_checkSolvedCompletedProjects;this.submittingAssessment=!0;this.saveAnswers('mc',!0);this.saveAnswers('oe',!0);$.post('/backend/requests/organizations/candidate_submit_assessment.php',{user:username,testId:that.testId},function(data){var data=JSON.parse(data);if(data&&data.status==='success'){console.log('submitted assessment',data);window.location.reload()}else{alert('There was an issue submitting your assessment. Please reload this page and try again (you will not lose your answers).')}})}},leaveAssessment:function(){if(this.assessmentObject&&this.assessmentObject.data.post_assessment_redirect_url&&this.assessmentObject.data.post_assessment_redirect_url!==''){var redirUrl=this.assessmentObject.data.post_assessment_redirect_url;redirUrl=redirUrl.replace('{{USERNAME}}',this.authObject.username);redirUrl=redirUrl.replace('{{EMAIL}}',this.authObject.email);redirUrl=redirUrl.replace('{{ASSESSMENT_ID}}',this.testId);window.location.href='/logout?candidateDone=true&redirectCandidate='+btoa(redirUrl)}else{window.location.href='/logout?candidateDone=true'}},reorderSections:function(){var newOrder=this.assessmentObject.data.section_ordering;if(!newOrder)return;var sectionElements=$('.chalSectionCanReorder');console.log('reordering sections');for(var i=0;i<newOrder.length;i++){var sectionTypeKey=newOrder[i].toLowerCase().replace(' ','-');for(var k=0;k<sectionElements.length;k++){if(sectionTypeKey===$(sectionElements[k]).attr('data-reordertype')){var sec=$(sectionElements[k]).detach();$('.rightSideActualSections').append(sec)}}}},beginChallenge:function(event,challengeObject){if(event&&event.srcElement&&event.srcElement.classList&&event.srcElement.classList.contains('hiddenProgLoading')){return}
var that=this;var tier=challengeObject.tier;if(this.startingChallengeButton)return;this.startingChallengeButton=challengeObject.title;var isPreviewMode='';if(this.assessmentObject.data.previewing_test){isPreviewMode='?previewMode=true'}
var data={challenge_title:challengeObject.title,};$.post('/backend/requests/editor/begin_challenge.php',data,function(data){console.log(data);if(data){data=JSON.parse(data);if(data.status==='success'){if(tier=='1'||tier=='2'||tier=='3'||tier=='4'){window.location.href='/editor/'+challengeObject.title+':'+that.defaultLanguage+isPreviewMode}
if(tier=='5'){window.location.href='/editor/frontend:'+challengeObject.title+isPreviewMode}
if(tier=='6'){window.location.href='/editor/sqlsandbox:'+challengeObject.title+isPreviewMode}
if(tier=='7'){window.location.href='/editor/languagespecific:'+challengeObject.title+isPreviewMode}
if(tier=='8'){window.location.href='/editor/graphql:'+challengeObject.title+isPreviewMode}
if(tier=='9'){window.location.href='/editor/mongodbsandbox:'+challengeObject.title+isPreviewMode}
if(tier=='10'){window.location.href='/editor/spreadsheet:'+challengeObject.title+isPreviewMode}
if(tier=='11'){window.location.href='/editor/jupyter:'+challengeObject.title+isPreviewMode}}}
setTimeout(function(){that.startingChallengeButton=!1},1000)})},getSolvedChallenges:function(){var that=this;$.get('/backend/requests/challenges/get_completed.php?u='+this.authObject.username+'&t='+(+new Date()).toString(),function(resp){if(resp){var data=JSON.parse(resp);var completed=data.completed;if(completed&&completed.length>0){console.log('completed challenges',completed);var buttons=$('.coding_chals_list.only_chals li');$.each(buttons,function(){var chal_title=$(this).find('span').text().trim();chal_title=chal_title.replace('C#','Csharp');if(completed.includes(chal_title)){$(this).find('button.challengeStart').html('&#x2714; Completed');$(this).find('button.challengeStart').addClass('completed');$(this).find('button.challengePostVideo').addClass('canRecord');that.solvedChallenges+=1}})}
if(that.assessmentObject.data.masked_challenges){console.log('** masking challenge titles now **');that.replaceChallengeTitlesWithMask=!0}
if(that.assessmentObject.data.progressive_loading&&that.assessmentObject.data.progressive_loading['Coding challenges']){var stopShowing=!1;var buttons=$('.coding_chals_list.only_chals li');$.each(buttons,function(){var chal_title=$(this).find('span').text().trim();chal_title=chal_title.replace('C#','Csharp');if(stopShowing){$(this).find('button').html('Solve prior challenge to see this challenge');$(this).find('button').attr('class','hiddenProgLoading')}
if(!completed.includes(chal_title)){stopShowing=!0}})}}})},openPersonalityTest:function(){var that=this;this.showingPersonalitySection=!0;var personalityObject=this.assessmentObject.data.personality_test;var url=`https://cb-personality-testing-e66ce2965ad3.herokuapp.com/${personalityObject.type}/${personalityObject.jwt}`;if(this.assessmentObject.data.previewing_test){url=`https://cb-personality-testing-e66ce2965ad3.herokuapp.com/${personalityObject.type}/demo`}
var embedHTML='<iframe src="'+url+'" referrerpolicy="no-referrer-when-downgrade" frameborder="0"></iframe>';setTimeout(function(){document.querySelector('#personality-test-wrapper').innerHTML=embedHTML},200);if(!this.assessmentObject.data.previewing_test){window.addEventListener('message',(event)=>{if(event.origin==='https://cb-personality-testing-e66ce2965ad3.herokuapp.com'){console.log('personality test complete',event.data);localStorage.setItem(that.storageKeyPersonalityTest,'true');that.completedPersonalityTest=!0;var params={testId:that.testId,personalityTestType:personalityObject.type,};$.post('/backend/requests/organizations/candidate_personality_save.php',params,function(resp){console.log('saved to database',resp)})}},!1)}},toggleVideoResponseModal:function(event=null,questionId=!1,challengeTitleWebcamResponse=null){if(challengeTitleWebcamResponse&&event&&event.srcElement&&!event.srcElement.classList.contains('canRecord')){$.cursorMessage('Please solve the challenge first.',{hideTimeout:0});$('li').live('mouseout',function(){$.hideCursorMessage()});return}
if(this.assessmentObject.data.org_id==='hexaviewtechnologies-vmrq9'||this.assessmentObject.data.org_id==='propeltechnologygroupi-kwu98'||this.assessmentObject.data.org_id==='smarttask-3kf74'||this.assessmentObject.data.org_id==='suryasoftwaresystems-gkjuv'||this.assessmentObject.data.org_id==='bevycommerceinc-hs0vu'||this.assessmentObject.data.org_id==='kraftpixeldigitalsoluti-9y0ll'||this.assessmentObject.data.org_id==='sarasanalyticsllc-n3fkk'||this.assessmentObject.data.org_id==='wingsfin-xadhc'||this.assessmentObject.data.org_id==='infogain-s4uot'||this.assessmentObject.data.org_id==='zemosotechnologies-3pw0w'||this.assessmentObject.data.org_id==='lear-2nmdz'||this.assessmentObject.data.org_id==='rocketdevs-8nzi9'||this.assessmentObject.data.org_id==='suvida-zzssj'){alert('Limit reached for video responses. Please contact the company admin to resolve this issue.');return}
this.showing.modalBeginVideoResponse=!this.showing.modalBeginVideoResponse;$('.modalVideoText').html('');if(this.showing.modalBeginVideoResponse){if(questionId){if(challengeTitleWebcamResponse){var codeToShow=window.localStorage.getItem('coderbyteSolutionSnippet-'+challengeTitleWebcamResponse);if(!codeToShow){codeToShow='Please explain the thought process behind your solution to this challenge.'}else{codeToShow='Please explain this code sample from your solution:<br><pre class="ql-syntax" spellcheck="false">'+codeToShow+'</pre>'}
$('.modalVideoText').html(codeToShow)}else{for(var i=0;i<this.assessmentObject.data.open_ended_questions.length;i++){var this_oe=this.assessmentObject.data.open_ended_questions[i];if(questionId==this_oe[0]){$('.modalVideoText').html(this_oe[1]);break}}}
setTimeout(function(){highlightCodeSnippetsOnPage(['.videoResponseControls h3'])},250)}
this.connectToCamera(questionId)}else{var tracks=this.videoStream.getTracks();for(var i=0;i<tracks.length;i++){tracks[i].stop()}
this.videoStream=!1;this.stopVideoRecording();this.replayVideoResponseRecording({reset:!0})}},connectToCamera:async function(questionId){var that=this;try{var stream=await navigator.mediaDevices.getUserMedia({audio:!0,video:{width:500,height:350}});console.log('getUserMedia() got stream:',stream);var streamingLiveVideo=document.querySelector('video#streamingLiveVideo');streamingLiveVideo.srcObject=stream;that.videoStream=stream;if(that.videoSteamForWhatOE&&questionId!==that.videoSteamForWhatOE){that.replayVideoResponseRecording({reset:!0})}
that.videoSteamForWhatOE=questionId}catch(e){console.error('navigator.getUserMedia error:',e);alert(`Unable to connect to webcam: navigator.getUserMedia error: ${e.toString()}`)}},startServerVideoRecording:function(){var that=this;var username=this.authObject.username;var randomAppendId=Math.random().toString().substr(2,5);if(!Twilio||!Twilio.Video){alert('Error starting video call.');return}
var params={user:username,};this.replayVideoResponseRecording({reset:!0});$.post('/backend/requests/organizations/candidate_video_response_begin.php?roomId='+randomAppendId,params,function(resp){console.log('got token for twilio from server');var token=resp;Twilio.Video.connect(token,{name:`video-response-${username}-${randomAppendId}`}).then(room=>{console.log(`successfully joined a room: ${room}`);that.twilioRoom=room;that.startRecordingVideoLocally()},error=>{alert(`unable to connect to room: ${error.message}`);console.error(`unable to connect to room: ${error.message}`)})})},startRecordingVideoLocally:function(){var that=this;this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(that.videoStream)}catch(e){console.error('Exception while creating MediaRecorder:',e);alert(`Exception while creating MediaRecorder: ${JSON.stringify(e)}`);return}
console.log('Created MediaRecorder',this.mediaRecorder);this.mediaRecorder.ondataavailable=this.handleVideoDataAvailable;this.mediaRecorder.onstop=function(event){console.log('Recorder stopped: ',event);console.log('Recorded Blobs: ',that.recordedBlobs);clearInterval(that.timerInternal);that.timerInternal=!1;that.timerSeconds=that.assessmentObject.data.org_id==='coderbytesandbox'?15:120;if(that.assessmentObject.data.org_id==='rightbalance-k55eh'){that.timerSeconds=1200}
if(that.showing.modalBeginVideoResponse){that.replayVideoResponseRecording()}};this.mediaRecorder.start();if(this.timerInternal){clearInterval(this.timerInternal);this.timerInternal=!1;this.timerSeconds=this.assessmentObject.data.org_id==='coderbytesandbox'?15:120;if(this.assessmentObject.data.org_id==='rightbalance-k55eh'){this.timerSeconds=1200}}
this.timerInternal=setInterval(function(){that.timerSeconds-=1;if(that.timerSeconds<=0){that.stopVideoRecording()}},1000);console.log('MediaRecorder started',this.mediaRecorder)},handleVideoDataAvailable:function(event){if(event.data&&event.data.size>0){this.recordedBlobs.push(event.data)}},stopVideoRecording:function(){if(this.twilioRoom){this.twilioRoom.disconnect()}
if(this.mediaRecorder&&this.mediaRecorder.state!=='inactive'){this.mediaRecorder.stop()}},replayVideoResponseRecording:function(opts){if(!opts&&(!this.recordedBlobs||this.recordedBlobs.length===0)){console.log('Error showing replay video, no Blob events');return}
var recordedVideo=document.querySelector('video#playbackVideo');if(opts&&opts.reset){$('#streamingLiveVideo').css({'display':'block'});$('#playbackVideo').css({'display':'none'});recordedVideo.src=null;recordedVideo.srcObject=null;recordedVideo.controls=!1;this.recordedBlobs=[];return}
$('#streamingLiveVideo').css({'display':'none'});$('#playbackVideo').css({'display':'block'});var superBuffer=new Blob(this.recordedBlobs);recordedVideo.src=null;recordedVideo.srcObject=null;recordedVideo.src=window.URL.createObjectURL(superBuffer);recordedVideo.controls=!0;recordedVideo.play()},submitVideoResponse:function(){if(this.assessmentObject.data.previewing_test)return;var that=this;var r=confirm('Once you submit this video response you cannot change it. Are you sure you want submit it?');if(!r)return;var twilioRoomId=this.twilioRoom.sid;var oeId=this.videoSteamForWhatOE;var params={user:this.authObject.username,testId:this.testId,OEId:oeId,};$.post('/backend/requests/organizations/candidate_video_response_save.php?roomId='+twilioRoomId,params,function(resp){console.log('response from saving video in database',resp);if(resp){var data=JSON.parse(resp);if(data&&data.status==='success'){if(oeId&&oeId.toString().includes('challenge-')){that.$set(that.webcamVerificationSubmitted,oeId.replace('challenge-',''),!0);localStorage.setItem(that.storageKeyAnswersWebcamResponses,JSON.stringify(that.webcamVerificationSubmitted))}else{that.$set(that.videoResponsesSubmitted,oeId,!0);localStorage.setItem(that.storageKeyAnswersVideoResponses,JSON.stringify(that.videoResponsesSubmitted))}
that.toggleVideoResponseModal()}else{alert('Error saving video response: '+data.message)}}else{alert('Error saving video response, no response from server.')}})},uploadFile:function(questionId){var that=this;var file_data=$('.fileAttachment_'+questionId)[0].files[0];if(!file_data||this.uploadingFile)return;var formData=new FormData();formData.append('file_data',file_data);formData.append('test_id',that.testId);formData.append('oe_id',questionId);this.uploadingFile=questionId;$.ajax({url:'/backend/requests/organizations/candidate_file_upload.php',data:formData,type:'POST',contentType:!1,processData:!1,success:function(resp){console.log(resp);var data=JSON.parse(resp);if(data&&data.status==='success'){that.uploadingFile=!1;that.$set(that.videoResponsesSubmitted,questionId,data.fileUrl);localStorage.setItem(that.storageKeyAnswersVideoResponses,JSON.stringify(that.videoResponsesSubmitted));that.saveOEAnswer(questionId,'FILEURL::'+data.fileUrl);that.saveTempAnswersInLocalStorage();that.saveAnswers('oe',!0)}else{var errorMsg=data.message?data.message:'Error uploading file';alert(errorMsg+'. Please contact support@coderbyte.com')}}})},__OEHasVideoResponse:function(questionId){return this.assessmentObject.data.video_response_options&&this.assessmentObject.data.video_response_options[questionId]},__displayTimerCountdown:function(timerSeconds){var m=Math.floor(timerSeconds/60);var s=Math.round(timerSeconds%60);if(s.toString().length===1){s='0'+s}
return `${m}:${s}`},__watchForFileInputChanges:function(){$('input[type="file"]').bind('change',function(){console.log('added file');var fileText=$('input[type="file"]').val().split('\\').pop();fileText=fileText.substr(0,30)+(fileText.length>30?'..':'');if(fileText==='')fileText='No file selected';$(this).parent().find('.showFileInputText').html(fileText)})},},});$('.submit_final_assessment.onPreview').click(function(){$.cursorMessage('Submitting this assessment is disabled in preview mode.',{hideTimeout:0})});$('.submit_final_assessment.onPreview').live('mouseout',function(){$.hideCursorMessage()});$('.cannotSubmitVideo').click(function(){$.cursorMessage('Submitting video responses is disabled in preview mode.',{hideTimeout:0})});$('.cannotSubmitVideo').live('mouseout',function(){$.hideCursorMessage()});$('.cannotUploadFile').click(function(){$.cursorMessage('Uploading files is disabled in preview mode.',{hideTimeout:0})});$('.cannotUploadFile').live('mouseout',function(){$.hideCursorMessage()});if(window.interact){interact('.draggable').draggable({inertia:!0,modifiers:[interact.modifiers.restrictRect({restriction:'#container',endOnly:!0})],autoScroll:!0,listeners:{move(event){var target=event.target
var x=(parseFloat(target.getAttribute('data-x'))||0)+event.dx
var y=(parseFloat(target.getAttribute('data-y'))||0)+event.dy
target.style.webkitTransform=target.style.transform='translate('+x+'px, '+y+'px)'
target.setAttribute('data-x',x)
target.setAttribute('data-y',y)}}})}
function setupQuillsForQuestions(){var questions=$('.OEAnswerArea');for(var i=0;i<questions.length;i++){if(!$(questions[i]).hasClass('ql-container')){$(questions[i]).html($(questions[i]).text());var newQuill=new Quill(questions[i],window.__org_quillDefaults.welcomeConfig);removeFormattingFromQuillEditor(newQuill)}}}})